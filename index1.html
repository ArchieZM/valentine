<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Валентинка</title>
  <style>
    /* Сброс отступов и настройка базовых стилей */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(to bottom right, #ffccff, #000);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: sans-serif;
      color: white;
    }
    /* Общие стили для этапов */
    #stage1, #stage2, #stage3, #stage4 {
      position: absolute;
      width: 100%;
      height: 100%;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    /* Отображаем активный этап */
    .active {
      display: flex;
    }
    .continue-btn, .restart-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .continue-btn {
      background-color: #00aaff;
    }
    .restart-btn {
      background-color: #ff6699;
    }
    /* Анимация пульсации сердца */
    @keyframes beat {
      0% { transform: scale(1); }
      25% { transform: scale(1.1); }
      50% { transform: scale(1); }
      75% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }
    /* Элемент сердца на этапе 4 */
    #heart {
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at 50% 50%, #ff99cc, #cc66ff);
      /* Простейшая векторная форма сердца (clip-path можно заменить SVG или другим решением) */
      clip-path: path("M 10,30 A 20,20 0,0,1,50,30 Q 50,60 30,80 Q 10,60 10,30 z");
      animation: beat 1s infinite;
    }
    /* Canvas на всю страницу (для анимации формирования сердца) */
    #canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <!-- Этап 1: Начальный экран -->
  <div id="stage1" class="active">
    <h1>Я люблю тебя ♥️</h1>
    <button id="continueBtn" class="continue-btn">Продолжить</button>
  </div>
  
  <!-- Этап 2: Переход (симуляция затемнения) -->
  <div id="stage2">
    <!-- Здесь можно добавить дополнительные эффекты при переходе -->
  </div>
  
  <!-- Этап 3: Формирование сердца (анимация на canvas) -->
  <div id="stage3">
    <canvas id="canvas"></canvas>
  </div>
  
  <!-- Этап 4: Биение сердца -->
  <div id="stage4">
    <div id="heart"></div>
    <button id="restartBtn" class="restart-btn">Начать сначала</button>
  </div>

  <script>
    // Настройка canvas
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Элементы этапов
    const stage1 = document.getElementById('stage1');
    const stage2 = document.getElementById('stage2');
    const stage3 = document.getElementById('stage3');
    const stage4 = document.getElementById('stage4');
    const continueBtn = document.getElementById('continueBtn');
    const restartBtn = document.getElementById('restartBtn');

    // Обработка нажатия кнопки "Продолжить"
    continueBtn.addEventListener('click', () => {
      // Переходим с этапа 1 на этап 2
      stage1.classList.remove('active');
      stage2.classList.add('active');

      // Анимация: кнопка улетает вверх
      continueBtn.style.transition = "transform 0.5s ease-out, opacity 0.5s ease-out";
      continueBtn.style.transform = "translateY(-100px)";
      continueBtn.style.opacity = "0";

      // Через 0.8 сек – переключаемся на этап 3, имитируя затемнение экрана
      setTimeout(() => {
        stage2.classList.remove('active');
        stage3.classList.add('active');
        startHeartFormation();
      }, 800);
    });

    // Функция анимации формирования сердца (Этап 3)
    function startHeartFormation() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const lines = [];
      const totalLines = 50;
      // Генерируем линии, стартующие с краёв экрана
      for (let i = 0; i < totalLines; i++) {
        let startX, startY;
        if (Math.random() < 0.5) {
          startX = Math.random() < 0.5 ? 0 : canvas.width;
          startY = Math.random() * canvas.height;
        } else {
          startX = Math.random() * canvas.width;
          startY = Math.random() < 0.5 ? 0 : canvas.height;
        }
        lines.push({x: startX, y: startY});
      }

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const animationDuration = 2000; // 2 секунды
      const startTime = performance.now();

      function animate() {
        const now = performance.now();
        const elapsed = now - startTime;
        const t = Math.min(elapsed / animationDuration, 1);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        lines.forEach(line => {
          // Линейная интерполяция от точки старта к центру
          const currentX = line.x + (centerX - line.x) * t;
          const currentY = line.y + (centerY - line.y) * t;
          ctx.beginPath();
          ctx.moveTo(line.x, line.y);
          ctx.lineTo(currentX, currentY);
          // Цвет линий с эффектом неона (розово-фиолетовый)
          ctx.strokeStyle = 'rgba(255, 102, 204, ' + (1 - t) + ')';
          ctx.lineWidth = 2;
          ctx.stroke();
        });
        if (t < 1) {
          requestAnimationFrame(animate);
        } else {
          // После завершения анимации переходим на этап 4
          setTimeout(() => {
            stage3.classList.remove('active');
            stage4.classList.add('active');
          }, 500);
        }
      }
      animate();
    }

    // Кнопка "Начать сначала" перезагружает веб-приложение
    restartBtn.addEventListener('click', () => {
      window.location.reload();
    });
  </script>
</body>
</html>
