<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Сердечко для тебя</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Marck+Script&display=swap');
    
    body {
      background: radial-gradient(circle at center, #1a0000 0%, #000 100%);
      font-family: 'Marck Script', cursive;
      text-align: center;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      perspective: 1000px;
    }
    
    .card {
      position: relative;
      background: rgba(20, 0, 0, 0.7);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(255, 50, 50, 0.2);
      backdrop-filter: blur(8px);
      transform-style: preserve-3d;
      transform: rotateY(5deg);
      transition: all 1.2s cubic-bezier(0.17, 0.67, 0.21, 0.99);
      opacity: 0;
      animation: cardAppear 2s forwards 0.5s;
    }
    
    .text {
      font-size: 28px;
      margin: 25px 0;
      color: #fff;
      text-shadow: 0 0 8px rgba(255, 100, 100, 0.5);
      opacity: 0;
      transform: translateY(30px);
      transition: all 1s ease-out;
      position: relative;
      animation: textAppear 1.5s forwards var(--delay);
    }
    
    .canvas-container {
      position: relative;
      width: 320px;
      height: 320px;
      margin: 30px auto;
      transform: scale(0.9);
    }
    
    #backgroundCanvas, #heartCanvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    
    @keyframes cardAppear {
      from { opacity: 0; transform: rotateY(15deg) translateY(50px); }
      to { opacity: 1; transform: rotateY(5deg) translateY(0); }
    }
    
    @keyframes textAppear {
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes heartBeat {
      0% { transform: scale(1); }
      25% { transform: scale(1.05); }
      50% { transform: scale(1); }
      75% { transform: scale(1.03); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="card">
    <p class="text top" style="--delay: 1.5s">Ты наполнил</p>
    <div class="canvas-container">
      <canvas id="backgroundCanvas" width="320" height="320"></canvas>
      <canvas id="heartCanvas" width="320" height="320"></canvas>
    </div>
    <p class="text bottom" style="--delay: 2s">моё сердце теплом</p>
  </div>

  <script>
    // Инициализация элементов
    const bgCanvas = document.getElementById('backgroundCanvas');
    const bgCtx = bgCanvas.getContext('2d');
    const heartCanvas = document.getElementById('heartCanvas');
    const heartCtx = heartCanvas.getContext('2d');
    const centerX = heartCanvas.width / 2;
    const centerY = heartCanvas.height / 2;
    const points = [];
    
    // Функция формы сердца
    function heartShape(t) {
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
      return [centerX + x * 8, centerY + y * 8];
    }
    
    // Создание точек сердца
    for (let i = 0; i < 300; i++) {
      const angle = (Math.PI * 2 * i) / 300;
      points.push(heartShape(angle));
    }
    
    // Переменные анимации
    let drawnLines = 0;
    const totalLines = 800;
    let fillProgress = 0;
    const fillSpeed = 0.005; // Увеличена скорость заполнения
    let lastFrameTime = 0;
    const frameInterval = 1000 / 60;
    
    // Функция рисования линий
    function drawLine(timestamp) {
      if (!lastFrameTime) lastFrameTime = timestamp;
      const elapsed = timestamp - lastFrameTime;
      
      if (elapsed > frameInterval && drawnLines < totalLines) {
        lastFrameTime = timestamp - (elapsed % frameInterval);
        
        const linesPerFrame = Math.min(5, totalLines - drawnLines);
        for (let n = 0; n < linesPerFrame; n++) {
          const i = Math.floor(Math.random() * points.length);
          const j = Math.floor(Math.random() * points.length);
          
          const progress = drawnLines / totalLines;
          const hue = 350 + progress * 10;
          const saturation = 70;
          const lightness = 40 + progress * 10;
          
          bgCtx.strokeStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
          bgCtx.lineWidth = 0.3 + progress * 1.5;
          
          bgCtx.beginPath();
          bgCtx.moveTo(points[i][0], points[i][1]);
          bgCtx.lineTo(points[j][0], points[j][1]);
          bgCtx.stroke();
          
          drawnLines++;
        }
      }
      
      if (drawnLines < totalLines) {
        requestAnimationFrame(drawLine);
      } else {
        startHeartBeat();
      }
    }
    
    // Анимация заполнения сердца (без замедления)
    function animateFill(timestamp) {
      fillProgress = Math.min(fillProgress + fillSpeed, 1);
      
      heartCtx.clearRect(0, 0, heartCanvas.width, heartCanvas.height);
      heartCtx.fillStyle = "#000";
      heartCtx.fillRect(0, 0, heartCanvas.width, heartCanvas.height);
      heartCtx.globalCompositeOperation = "destination-out";
      
      heartCtx.beginPath();
      const visiblePoints = points.length * fillProgress;
      
      for (let i = 0; i < visiblePoints; i++) {
        if (i === 0) {
          heartCtx.moveTo(points[i][0], points[i][1]);
        } else {
          heartCtx.lineTo(points[i][0], points[i][1]);
        }
      }
      
      if (fillProgress < 1) {
        heartCtx.lineTo(centerX, centerY);
      }
      
      heartCtx.closePath();
      heartCtx.fill();
      heartCtx.globalCompositeOperation = "source-over";
      
      if (fillProgress < 1) {
        requestAnimationFrame(animateFill);
      }
    }
    
    // Яркая и быстрая пульсация сердца
    function startHeartBeat() {
      heartCanvas.style.animation = "heartBeat 1.2s infinite ease-in-out";
      
      // Добавляем внутреннее свечение при пульсации
      function pulseGlow(timestamp) {
        const scale = parseFloat(getComputedStyle(heartCanvas).transform.split(',')[3] || 1);
        const glowIntensity = (scale - 1) * 20;
        
        heartCtx.globalCompositeOperation = "source-over";
        heartCtx.fillStyle = `rgba(255, 100, 100, ${glowIntensity * 0.03})`;
        heartCtx.beginPath();
        for (let i = 0; i < points.length; i++) {
          if (i === 0) heartCtx.moveTo(points[i][0], points[i][1]);
          else heartCtx.lineTo(points[i][0], points[i][1]);
        }
        heartCtx.closePath();
        heartCtx.fill();
        
        requestAnimationFrame(pulseGlow);
      }
      
      pulseGlow();
    }
    
    // Инициализация
    function init() {
      // Настройка canvas
      bgCtx.globalCompositeOperation = 'source-over';
      heartCtx.globalCompositeOperation = 'source-over';
      
      // Начало анимаций
      setTimeout(() => {
        requestAnimationFrame(drawLine);
        requestAnimationFrame(animateFill);
      }, 1500);
    }
    
    // Запуск
    window.addEventListener('load', init);
  </script>
</body>
</html>
