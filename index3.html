<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Валентинка</title>
  <style>
    /* Общие стили для адаптации на мобильных устройствах */
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: sans-serif;
    }
    /* Этап 1: Начальный экран с переливом фона */
    #stage1 {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #FFC0CB, #000000);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
    }
    .continue-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background: #00BFFF;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    /* Плавающие элементы (сердечки и слова) */
    .floating {
      position: absolute;
      font-size: 24px;
      opacity: 0.7;
      animation: floatUp 10s linear infinite;
    }
    @keyframes floatUp {
      from { transform: translateY(0); opacity: 0.7; }
      to { transform: translateY(-100px); opacity: 0; }
    }
    /* Кнопка перезапуска */
    .restart-btn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: #00BFFF;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      display: none;
    }
    /* Canvas занимает весь экран */
    #heartCanvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <!-- Этап 1: Начальный экран -->
  <div id="stage1">
    <h1>Я люблю тебя♥️</h1>
    <div id="floatingElements"></div>
    <button class="continue-btn" id="continueBtn">Продолжить</button>
  </div>

  <!-- Canvas для анимаций этапов 3 и 4 -->
  <canvas id="heartCanvas"></canvas>
  <!-- Кнопка для перезапуска валентинки -->
  <button class="restart-btn" id="restartBtn">Начать сначала</button>

  <script>
    // Настройка canvas
    const canvas = document.getElementById('heartCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const continueBtn = document.getElementById('continueBtn');
    const stage1 = document.getElementById('stage1');
    const restartBtn = document.getElementById('restartBtn');

    // Обработчик нажатия кнопки "Продолжить"
    continueBtn.addEventListener('click', () => {
      // Этап 2: Плавное перемещение кнопки вверх
      continueBtn.style.transition = 'transform 1s';
      continueBtn.style.transform = 'translateY(-100px)';
      // Затем плавное исчезновение экрана
      setTimeout(() => {
        stage1.style.opacity = '0';
      }, 1000);
      // После короткой задержки скрываем первый экран и запускаем формирование сердца
      setTimeout(() => {
        stage1.style.display = 'none';
        startHeartFormation();
      }, 1500);
    });

    // Функция для формирования сердца (Этап 3)
    function startHeartFormation(){
      let progress = 0;
      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Рисуем неоновые нити – для простоты используем кривую по параметрическому уравнению сердца
        ctx.strokeStyle = 'rgba(255,105,180,0.7)';  // розово-фиолетовый оттенок
        ctx.lineWidth = 2;
        ctx.beginPath();
        let first = true;
        for(let t = 0; t < Math.PI * 2; t += 0.01) {
          let x = 16 * Math.pow(Math.sin(t), 3);
          let y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
          x = canvas.width/2 + x * 10;
          y = canvas.height/2 - y * 10;
          if(first) { ctx.moveTo(x, y); first = false; }
          else { ctx.lineTo(x, y); }
        }
        ctx.stroke();
        progress += 0.01;
        if(progress < 1.0) {
          requestAnimationFrame(draw);
        } else {
          // После формирования – запускаем пульсацию сердца (Этап 4)
          startHeartBeat();
        }
      }
      draw();
    }

    // Функция пульсации сердца (Этап 4)
    function startHeartBeat(){
      let scale = 1;
      let growing = true;
      function beat() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(canvas.width/2, canvas.height/2);
        ctx.scale(scale, scale);
        ctx.translate(-canvas.width/2, -canvas.height/2);
        ctx.strokeStyle = 'rgba(255,20,147,0.8)';  // розовый с фиолетовыми оттенками
        ctx.lineWidth = 4;
        ctx.beginPath();
        let first = true;
        for(let t = 0; t < Math.PI * 2; t += 0.01) {
          let x = 16 * Math.pow(Math.sin(t), 3);
          let y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
          x = canvas.width/2 + x * 10;
          y = canvas.height/2 - y * 10;
          if(first) { ctx.moveTo(x, y); first = false; }
          else { ctx.lineTo(x, y); }
        }
        ctx.stroke();
        ctx.restore();

        if(growing) {
          scale += 0.005;
          if(scale >= 1.05) growing = false;
        } else {
          scale -= 0.005;
          if(scale <= 0.95) growing = true;
        }
        requestAnimationFrame(beat);
      }
      beat();
      // Отображаем кнопку перезапуска
      restartBtn.style.display = 'block';
    }

    // Обработчик кнопки "Начать сначала"
    restartBtn.addEventListener('click', () => {
      // При наличии Telegram Web App API отправляем данные обратно боту
      if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.sendData("restart");
      }
      // Перезагружаем страницу для повторного запуска анимации
      location.reload();
    });

    // Функция для добавления плавающих элементов (сердечки и романтические слова) в Этапе 1
    function addFloatingElements(){
      const floatingElements = document.getElementById('floatingElements');
      const words = ['Любовь', 'Счастье', 'Ты — моя звезда'];
      // Добавляем несколько плавающих сердечек
      for(let i = 0; i < 5; i++){
        let heart = document.createElement('span');
        heart.innerText = '❤️';
        heart.classList.add('floating');
        heart.style.left = Math.random() * 100 + '%';
        heart.style.top = Math.random() * 100 + '%';
        floatingElements.appendChild(heart);
      }
      // Добавляем плавающие романтические слова
      words.forEach(word => {
        let span = document.createElement('span');
        span.innerText = word;
        span.classList.add('floating');
        span.style.left = Math.random() * 100 + '%';
        span.style.top = Math.random() * 100 + '%';
        span.style.fontSize = '18px';
        span.style.opacity = 0.5;
        floatingElements.appendChild(span);
      });
    }
    addFloatingElements();
  </script>
</body>
</html>
