<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Сердечко для тебя</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Marck+Script&display=swap');
    
    body {
      background: radial-gradient(circle at center, #1a0000 0%, #000 100%);
      font-family: 'Marck Script', cursive;
      text-align: center;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      perspective: 1000px;
    }
    
    .card {
      position: relative;
      background: rgba(20, 0, 0, 0.7);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(255, 50, 50, 0.2);
      backdrop-filter: blur(8px);
      transform-style: preserve-3d;
      transform: rotateY(5deg);
      transition: all 1.2s cubic-bezier(0.17, 0.67, 0.21, 0.99);
      opacity: 0;
      animation: cardAppear 2s forwards 0.5s;
    }
    
    .card:hover {
      transform: rotateY(0deg) scale(1.02);
      box-shadow: 0 0 30px rgba(255, 80, 80, 0.3);
    }
    
    .text {
      font-size: 28px;
      margin: 25px 0;
      color: #fff;
      text-shadow: 0 0 8px rgba(255, 100, 100, 0.5);
      opacity: 0;
      transform: translateY(30px);
      transition: all 1s ease-out;
      position: relative;
    }
    
    .text.top {
      animation: textAppear 1.5s forwards 1.5s;
    }
    
    .text.bottom {
      animation: textAppear 1.5s forwards 2s;
    }
    
    .canvas-container {
      position: relative;
      width: 320px;
      height: 320px;
      margin: 30px auto;
      transform: scale(0.9);
      transition: transform 0.8s ease;
    }
    
    .canvas-container:hover {
      transform: scale(0.95);
    }
    
    #backgroundCanvas, #heartCanvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    
    .particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    
    .glow {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background: radial-gradient(circle at center, rgba(255, 50, 50, 0.1) 0%, transparent 70%);
      opacity: 0;
      animation: subtleGlow 6s infinite alternate 3s;
    }
    
    @keyframes cardAppear {
      from { opacity: 0; transform: rotateY(15deg) translateY(50px); }
      to { opacity: 1; transform: rotateY(5deg) translateY(0); }
    }
    
    @keyframes textAppear {
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes subtleGlow {
      0% { opacity: 0.2; transform: scale(0.98); }
      100% { opacity: 0.4; transform: scale(1.02); }
    }
    
    @keyframes heartPulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.01); opacity: 1; }
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(var(--tx), var(--ty)) rotate(180deg); }
    }
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <div class="glow"></div>
  
  <div class="card">
    <p class="text top">Ты наполнил</p>
    <div class="canvas-container">
      <canvas id="backgroundCanvas" width="320" height="320"></canvas>
      <canvas id="heartCanvas" width="320" height="320"></canvas>
    </div>
    <p class="text bottom">моё сердце теплом</p>
  </div>

  <script>
    // Инициализация элементов
    const bgCanvas = document.getElementById('backgroundCanvas');
    const bgCtx = bgCanvas.getContext('2d');
    const heartCanvas = document.getElementById('heartCanvas');
    const heartCtx = heartCanvas.getContext('2d');
    const centerX = heartCanvas.width / 2;
    const centerY = heartCanvas.height / 2;
    const points = [];
    
    // Улучшенная функция формы сердца
    function heartShape(t) {
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
      return [centerX + x * 8, centerY + y * 8];
    }
    
    // Создание более гладкого сердца (больше точек)
    for (let i = 0; i < 300; i++) {
      const angle = (Math.PI * 2 * i) / 300;
      points.push(heartShape(angle));
    }
    
    // Переменные анимации
    let drawnLines = 0;
    const totalLines = 800;
    let fillProgress = 0;
    const fillSpeed = 0.003;
    let pulsePhase = 0;
    let lastFrameTime = 0;
    const frameRate = 60;
    const frameInterval = 1000 / frameRate;
    
    // Функция плавного рисования линий
    function drawLine(timestamp) {
      if (!lastFrameTime) lastFrameTime = timestamp;
      const elapsed = timestamp - lastFrameTime;
      
      if (elapsed > frameInterval && drawnLines < totalLines) {
        lastFrameTime = timestamp - (elapsed % frameInterval);
        
        // Рисуем несколько линий за кадр для плавности
        const linesPerFrame = Math.min(3, totalLines - drawnLines);
        for (let n = 0; n < linesPerFrame; n++) {
          const i = Math.floor(Math.random() * points.length);
          const j = Math.floor(Math.random() * points.length);
          
          // Плавное изменение цвета и толщины
          const progress = drawnLines / totalLines;
          const hue = 350 + progress * 10; // Более мягкий переход цвета
          const saturation = 70 + progress * 10;
          const lightness = 50;
          const alpha = 0.3 + progress * 0.5; // Меньшая максимальная прозрачность
          
          bgCtx.strokeStyle = `hsla(${hue}, ${saturation}%, ${lightness}%, ${alpha})`;
          bgCtx.lineWidth = 0.5 + progress * 2; // Меньшая максимальная толщина
          bgCtx.lineCap = 'round';
          bgCtx.lineJoin = 'round';
          
          // Случайное смещение для органичности
          const offset = (Math.random() - 0.5) * 3 * (1 - progress);
          
          bgCtx.beginPath();
          bgCtx.moveTo(points[i][0] + offset, points[i][1] + offset);
          bgCtx.lineTo(points[j][0] + offset, points[j][1] + offset);
          bgCtx.stroke();
          
          drawnLines++;
        }
      }
      
      if (drawnLines < totalLines) {
        requestAnimationFrame(drawLine);
      } else {
        startFinalAnimation();
      }
    }
    
    // Анимация заполнения сердца
    function animateFill(timestamp) {
      fillProgress = Math.min(fillProgress + fillSpeed, 1);
      
      heartCtx.clearRect(0, 0, heartCanvas.width, heartCanvas.height);
      heartCtx.fillStyle = "#000";
      heartCtx.fillRect(0, 0, heartCanvas.width, heartCanvas.height);
      heartCtx.globalCompositeOperation = "destination-out";
      
      heartCtx.beginPath();
      const visiblePoints = points.length * Easing.easeOutQuad(fillProgress);
      
      for (let i = 0; i < visiblePoints; i++) {
        if (i === 0) {
          heartCtx.moveTo(points[i][0], points[i][1]);
        } else {
          heartCtx.lineTo(points[i][0], points[i][1]);
        }
      }
      
      // Плавное соединение с центром
      if (fillProgress < 1) {
        heartCtx.lineTo(centerX, centerY);
      }
      
      heartCtx.closePath();
      heartCtx.fill();
      heartCtx.globalCompositeOperation = "source-over";
      
      if (fillProgress < 1) {
        requestAnimationFrame(animateFill);
      }
    }
    
    // Финальная анимация (более мягкая пульсация)
    function startFinalAnimation() {
      function pulse(timestamp) {
        pulsePhase = (timestamp / 1500) * Math.PI; // Более медленная пульсация
        const scale = 1 + Math.sin(pulsePhase) * 0.008; // Меньшая амплитуда
        
        // Мягкое свечение внутри сердца
        heartCtx.globalCompositeOperation = "source-over";
        heartCtx.fillStyle = `rgba(255, 100, 100, ${Math.sin(pulsePhase) * 0.03})`;
        heartCtx.beginPath();
        for (let i = 0; i < points.length; i++) {
          if (i === 0) heartCtx.moveTo(points[i][0], points[i][1]);
          else heartCtx.lineTo(points[i][0], points[i][1]);
        }
        heartCtx.closePath();
        heartCtx.fill();
        
        // Очень легкая пульсация всего сердца
        heartCanvas.style.transform = `scale(${scale})`;
        
        requestAnimationFrame(pulse);
      }
      
      // Добавляем класс с анимацией для мягкого мерцания линий
      bgCanvas.style.animation = "heartPulse 3s infinite ease-in-out";
      
      requestAnimationFrame(pulse);
    }
    
    // Функции плавности
    const Easing = {
      easeOutQuad: function(t) {
        return t * (2 - t);
      }
    };
    
    // Создание частиц
    function createParticles() {
      const container = document.getElementById('particles');
      const colors = ['#ff6666', '#ff9999', '#ff8080', '#ff4d4d'];
      
      for (let i = 0; i < 60; i++) { // Меньше частиц
        const particle = document.createElement('div');
        particle.style.position = 'absolute';
        const size = Math.random() * 3 + 1; // Меньшие частицы
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        particle.style.borderRadius = '50%';
        particle.style.opacity = '0';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        
        // Уникальные параметры анимации для каждой частицы
        const tx = (Math.random() - 0.5) * 80;
        const ty = (Math.random() - 0.5) * 80;
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        
        particle.style.setProperty('--tx', `${tx}px`);
        particle.style.setProperty('--ty', `${ty}px`);
        particle.style.animation = `
          float ${duration}s infinite ease-in-out ${delay}s,
          fadeIn 3s forwards ${delay}s
        `;
        
        container.appendChild(particle);
      }
    }
    
    // Инициализация
    function init() {
      createParticles();
      
      // Настройка canvas
      bgCtx.globalCompositeOperation = 'lighter';
      heartCtx.globalCompositeOperation = 'source-over';
      
      // Начало анимаций
      setTimeout(() => {
        requestAnimationFrame(drawLine);
        requestAnimationFrame(animateFill);
      }, 1500);
    }
    
    // Запуск
    window.addEventListener('load', init);
  </script>
</body>
</html>
